<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, viewport-fit=cover">
    <title>MR Live2D Viewer</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000000; }
        #app { position: relative; width: 100vw; height: 100vh; }

        #controls {
            position: absolute;
            z-index: 20;
            top: 12px;
            right: 72px; /* avoid overlap with menu toggle */
            width: 240px;
            padding: 10px;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.62);
            color: #e6e6e6;
            font: 13px/1.3 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
            pointer-events: auto;
            transition: transform 220ms ease, opacity 220ms ease;
            will-change: transform;
        }

        #controls.collapsed { transform: translateX(110%); opacity: 0.0; pointer-events: none; }

        #controls label { display: block; margin: 6px 0 4px; font-size: 12px; }
        #controls select, #controls input[type="range"], #controls input[type="checkbox"] { font-size: 12px; }
        #controls button { font-size: 13px; padding: 6px 8px; }

        canvas { display: block; width: 100%; height: 100%; }

        /* Connecting / preloader UI */
        .connecting { cursor: progress !important; }
        /* Dim only the frame (canvas + live2d content), not the page background */
        .connecting #frame { filter: brightness(.95); transition: none; }
        #loading { display: none; position: absolute; right: 20px; bottom: 20px; width: 334px; height: 54px; background: url('assets/connecting.png') right bottom no-repeat; z-index: 40; pointer-events: none; }
        /* Adjust to a centered 4:3 viewport frame for landscape */
        .connecting #loading { display: block; }
        /* Position relative to a centered 4:3 frame (landscape). The calc uses min to choose the frame width */
        /* Align to the frame right edge (no extra inset) */
        #loading { right: calc((100vw - min(100vw, calc(100vh * 4 / 3))) / 2); }
        @media (max-width:520px) {
            /* Keep a small inset on narrow screens for visibility */
            #loading { right: 20px; bottom: 14px; width: 260px; height: 44px; background-size: contain; }
        }

        .menu-toggle {
            position: fixed;
            top: 12px;
            right: 12px;
            z-index: 30;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: rgba(0,0,0,0.6);
            color: #e6e6e6;
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .small { font-size: 12px; padding: 6px 8px; }

        @media (max-width: 520px) {
            #controls { width: 180px; padding: 8px; right: 8px; top: 8px; border-radius: 8px; }
            .menu-toggle { width: 34px; height: 34px; right: 8px; top: 8px; }
            #controls label { font-size: 11px; }
            #controls select, #controls input[type="range"] { font-size: 11px; }
            #controls button { font-size: 12px; padding: 5px 6px; }
        }
    </style>

    <script src="lib/live2dcubismcore.min.js"></script>
    <script src="lib/live2d.min.js"></script>
    <script src="lib/pixi.min.js"></script>
    <script src="lib/pixi-live2d-display-index.min.js"></script>
</head>
<body>
    <div id="app">
        <div id="frame">
            <canvas id="canvas"></canvas>
        </div>
        <button id="menuToggle" class="menu-toggle" aria-expanded="true" aria-label="Toggle controls">âœ•</button>
        <div id="loading" aria-hidden="true"></div>

        <div id="controls">
            <div style="display:flex;align-items:center;gap:8px;margin-right:8px;">
                <button id="captureBtn" class="small" type="button">Capture</button>
                <button id="randomBtn" class="small" type="button">Random</button>
                <div style="flex:1"></div>
            </div>

            <label for="characterSelect">Character</label>
            <select id="characterSelect"></select>

            <label for="outfitSelect">Outfit</label>
            <select id="outfitSelect"></select>

            <label for="motionSelect">Motion</label>
            <select id="motionSelect"></select>

            <label for="expressionSelect">Face</label>
            <select id="expressionSelect"></select>

            <!-- Assets base UI removed from controls (kept programmatically accessible via query param / localStorage / window.MR_ASSETS_*) -->

            <hr style="margin:10px 0;border:0;border-top:1px solid rgba(255,255,255,0.06);">

            <div style="display:flex;align-items:center;gap:8px;margin-top:8px;">
                <div style="margin-right:auto">Cheek</div>
                <div style="display:flex;gap:6px;">
                    <label><input type="radio" name="cheek" id="cheek0" value="-1" checked>-1</label>
                    <label><input type="radio" name="cheek" id="cheek0" value="0" checked>0</label>
                    <label><input type="radio" name="cheek" id="cheek1" value="1">1</label>
                    <label><input type="radio" name="cheek" id="cheek2" value="2">2</label>
                </div>
            </div>

            <div style="display:flex;align-items:center;gap:8px;margin-top:8px;">
                <label style="display:flex;align-items:center;gap:6px;"><input id="eyeClose" type="checkbox">Eye Close</label>
            </div>

            <div style="display:flex;align-items:center;gap:8px;margin-top:8px;">
                <label style="display:flex;align-items:center;gap:6px;"><input id="mouthOpen" type="checkbox">Mouth Open</label>
            </div>

            <div style="display:flex;align-items:center;gap:8px;margin-top:8px;">
                <label style="display:flex;align-items:center;gap:6px;"><input id="tear" type="checkbox">Tear</label>
            </div>

            <div style="display:flex;align-items:center;gap:8px;margin-top:8px;">
                <label style="display:flex;align-items:center;gap:6px;"><input id="soulGem" type="checkbox">Soul Gem</label>
            </div>

            <div style="display:flex;gap:8px;margin-top:6px;align-items:center;">
                <button id="micToggle" type="button">Start Mic Lipsync</button>
            </div>
            <div style="display:flex;align-items:center;gap:8px;margin-top:8px;">
            <label for="micSensitivity" style="font-size:12px;">Mic Sens</label>
            <input id="micSensitivity" type="range" min="0.25" max="2" step="0.05" value="1" style="flex:1;">
            </div>
        </div>


    </div>

    <script src="viewer.js"></script>
    <script src="live2d.js"></script>
    <script type="module" src="main.js"></script>
</body>
</html>
